name: CI
on: [push, pull_request]
jobs:
  lint:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2
      - run: npm install prettier
      - run: npm run format:check
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: rm -rf ./release_make/release-builds
      - run: mkdir -p ./release_make/release-builds/win/x64
      - run: mkdir -p ./release_make/release-builds/linux/x64
      - run: mkdir -p ./release_make/release-builds/macos/x64
      - run: mkdir -p ./release_make/release-builds/win/arm64
      - run: mkdir -p ./release_make/release-builds/linux/arm64
      - run: mkdir -p ./release_make/release-builds/macos/arm64
      - run: npm install pkg
      - run: npm install express@4.18.2
      - run: npx pkg ./release_make --target win-x64 --output ./release-builds/win/x64/FairyGround.exe || exit 1
      - run: test -f ./release-builds/win/x64/FairyGround.exe
      - run: npx pkg ./release_make --target linux-x64 --output ./release-builds/linux/x64/FairyGround || exit 1
      - run: test -f ./release-builds/linux/x64/FairyGround
      - run: npx pkg ./release_make --target node16-win-arm64 --output ./release-builds/win/arm64/FairyGround.exe || exit 1
      - run: test -f ./release-builds/win/arm64/FairyGround.exe
      - run: npx pkg ./release_make --target node16-linux-arm64 --output ./release-builds/linux/arm64/FairyGround || exit 1
      - run: test -f ./release-builds/linux/arm64/FairyGround
      - run: npx pkg ./release_make --target macos-x64 --output ./release-builds/macos/x64/FairyGround || exit 1
      - run: test -f ./release-builds/macos/x64/FairyGround
      - run: npx pkg ./release_make --target node16-macos-arm64 --output ./release-builds/macos/arm64/FairyGround || exit 1
      - run: test -f ./release-builds/macos/arm64/FairyGround
      - run: npm install
      - run: npm run build
      - run: cp -r ./public ./release_make/release-builds/win/x64/
      - run: cp -r ./public ./release_make/release-builds/win/arm64/
      - run: cp -r ./public ./release_make/release-builds/linux/x64/
      - run: cp -r ./public ./release_make/release-builds/linux/arm64/
      - run: cp -r ./public ./release_make/release-builds/macos/x64/
      - run: cp -r ./public ./release_make/release-builds/macos/arm64/
